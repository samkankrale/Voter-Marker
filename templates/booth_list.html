<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Booth-wise Voter Lists - VoterMarker</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* ================= ROOT VARIABLES ================= */
:root {
    --primary-orange: #d4762c;
    --primary-orange-hover: #b8621f;
    --primary-orange-light: rgba(212, 118, 44, 0.1);
    --dark-navy: #152238;
    --dark-navy-light: #1e3a5f;
    --success-green: #2E7D32;
    --success-green-light: #4CAF50;
    --danger-red: #e53935;
    --warning-orange: #ff9800;
    --text-dark: #333;
    --text-muted: #666;
    --text-light: #999;
    --bg-light: #f8f9fa;
    --bg-card: #ffffff;
    --border-light: #e0e0e0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.15);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    --radius-full: 50px;
}

/* ================= RESET ================= */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', "Segoe UI", system-ui, sans-serif;
    background: #a6a7ab;
    color: var(--text-dark);
    min-height: 100vh;
}

/* ================= MAIN CONTAINER ================= */
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
}

/* ================= FIXED HEADER ================= */
.fixed-header-wrapper {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #a6a7ab;
    margin: -20px -20px 0 -20px;
    padding: 20px 20px 15px 20px;
}

.header {
    background: linear-gradient(135deg, var(--dark-navy) 0%, var(--dark-navy-light) 100%);
    border-radius: var(--radius-lg);
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
}

.header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(212, 118, 44, 0.2) 0%, transparent 70%);
    border-radius: 50%;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 15px;
    z-index: 1;
}

.btn-back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 18px;
    border-radius: var(--radius-full);
    background: rgba(255,255,255,0.15);
    color: white;
    border: none;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.3s ease;
    text-decoration: none;
    backdrop-filter: blur(10px);
}

.btn-back:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
}

.header-title {
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1;
}

.header-logo {
    width: 40px;
    height: 40px;
    fill: var(--primary-orange);
}

.header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    font-weight: 700;
    color: white;
    margin: 0;
}

.header-subtitle {
    font-size: 11px;
    color: rgba(255,255,255,0.7);
    font-weight: 400;
}

/* ================= SCROLLABLE CONTENT ================= */
.scrollable-content {
    margin-top: 20px;
}

/* ================= BOOTH SELECTOR ================= */
.booth-selector {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-md);
    margin-bottom: 20px;
}

.booth-selector h3 {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    color: var(--dark-navy);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.booth-selector h3 i {
    color: var(--primary-orange);
}

.select-wrapper {
    display: flex;
    gap: 12px;
    align-items: stretch;
}

#boothSelect {
    flex: 1;
    padding: 14px 20px;
    border-radius: var(--radius-full);
    border: 2px solid var(--border-light);
    font-family: 'Poppins', sans-serif;
    font-size: 14px;
    transition: all 0.3s ease;
    cursor: pointer;
    appearance: none;
    background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 20px center;
}

#boothSelect:focus {
    outline: none;
    border-color: var(--primary-orange);
    box-shadow: 0 0 0 4px var(--primary-orange-light);
}

.btn-load {
    padding: 14px 28px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--primary-orange), var(--primary-orange-hover));
    color: white;
    border: none;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-load:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(212, 118, 44, 0.4);
}

.btn-load:disabled {
    background: var( --text-dark);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* ================= BOOTH INFO BOX ================= */
.booth-info-box {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 25px;
    box-shadow: var(--shadow-md);
    margin-bottom: 20px;
    display: none;
}

.booth-info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--bg-light);
}

.booth-info-header h3 {
    font-family: 'Playfair Display', serif;
    color: var(--dark-navy);
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.booth-info-header h3 i {
    color: var(--primary-orange);
    font-size: 18px;
}

.btn-download-pdf {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--dark-navy), var(--dark-navy-light));
    color: white;
    border: none;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-download-pdf:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(21, 34, 56, 0.4);
}

.booth-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
}

.stat-item {
    background: linear-gradient(135deg, var(--bg-light) 0%, #fff 100%);
    padding: 20px;
    border-radius: var(--radius-md);
    text-align: center;
    border-left: 4px solid var(--primary-orange);
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateX(5px);
    box-shadow: var(--shadow-sm);
}

.stat-item.visited {
    border-left-color: var(--success-green);
}

.stat-item.unvisited {
    border-left-color: var(--warning-orange);
}

.stat-item.percentage {
    border-left-color: var(--dark-navy);
}

.stat-item h4 {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
}

.stat-item .value {
    font-family: 'Playfair Display', serif;
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--dark-navy), var(--primary-orange));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-item.visited .value {
    background: linear-gradient(135deg, var(--success-green), var(--success-green-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-item.unvisited .value {
    background: linear-gradient(135deg, var(--warning-orange), #ffb74d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-item.percentage .value {
    background: linear-gradient(135deg, var(--dark-navy), var(--dark-navy-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ================= LOADING ================= */
.loading {
    display: none;
    text-align: center;
    padding: 40px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    margin-bottom: 20px;
    box-shadow: var(--shadow-md);
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--border-light);
    border-top: 4px solid var(--primary-orange);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading p {
    color: var(--text-muted);
    font-size: 14px;
}

/* ================= ERROR MESSAGE ================= */
.error-message {
    background: linear-gradient(135deg, #ffebee 0%, #fff 100%);
    color: var(--danger-red);
    padding: 15px 20px;
    border-radius: var(--radius-md);
    margin-bottom: 20px;
    display: none;
    border-left: 4px solid var(--danger-red);
    font-size: 14px;
}

.error-message i {
    margin-right: 10px;
}

/* ================= TABLE CONTAINER ================= */
.table-container {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    display: none;
}

.table-wrapper {
    overflow-x: auto;
    max-height: 600px;
    overflow-y: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    position: sticky;
    top: 0;
    z-index: 10;
}

th {
    background: var(--dark-navy);
    color: white;
    padding: 16px 14px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    text-align: left;
}

th:first-child {
    padding-left: 25px;
}

th:last-child {
    padding-right: 25px;
}

td {
    padding: 14px;
    border-bottom: 1px solid var(--border-light);
    font-size: 13px;
    color: var(--text-dark);
    white-space: nowrap;
}

td:first-child {
    padding-left: 25px;
    font-weight: 600;
    color: var(--dark-navy);
}

td:last-child {
    padding-right: 25px;
}

tr {
    transition: background-color 0.2s ease;
}

tr:hover {
    background-color: var(--bg-light);
}

tr.visited-row {
    background: rgba(46, 125, 50, 0.05);
}

tr.visited-row:hover {
    background: rgba(46, 125, 50, 0.1);
}

tr.not-visited-row {
    background: rgba(255, 152, 0, 0.05);
}

tr.not-visited-row:hover {
    background: rgba(255, 152, 0, 0.1);
}

/* ================= STATUS BADGE ================= */
.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: var(--radius-full);
    font-size: 11px;
    font-weight: 600;
}

.status-badge.visited {
    background: rgba(46, 125, 50, 0.1);
    color: var(--success-green);
}

.status-badge.not-visited {
    background: rgba(255, 152, 0, 0.1);
    color: var(--warning-orange);
}

/* ================= NO DATA ================= */
.no-data {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

.no-data i {
    font-size: 50px;
    color: var(--border-light);
    margin-bottom: 15px;
    display: block;
}

.no-data h4 {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    color: var(--dark-navy);
    margin-bottom: 8px;
}

.no-data p {
    font-size: 13px;
}

/* ================= EMPTY STATE ================= */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    display: none;
}

.empty-state i {
    font-size: 60px;
    color: var(--border-light);
    margin-bottom: 20px;
}

.empty-state h4 {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    color: var(--dark-navy);
    margin-bottom: 10px;
}

.empty-state p {
    color: var(--text-muted);
    font-size: 14px;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 1024px) {
    .dashboard-container {
        padding: 15px;
    }

    .fixed-header-wrapper {
        margin: -15px -15px 0 -15px;
        padding: 15px 15px 12px 15px;
    }
}

@media (max-width: 768px) {
    .header {
        flex-direction: column;
        gap: 15px;
        padding: 15px 20px;
    }

    .header-left {
        width: 100%;
        justify-content: space-between;
    }

    .header h2 {
        font-size: 18px;
    }

    .select-wrapper {
        flex-direction: column;
    }

    #boothSelect {
        width: 100%;
    }

    .btn-load {
        width: 100%;
        justify-content: center;
    }

    .booth-info-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }

    .btn-download-pdf {
        width: 100%;
        justify-content: center;
    }

    .booth-stats {
        grid-template-columns: repeat(2, 1fr);
    }

    th, td {
        padding: 12px 10px;
        font-size: 11px;
    }

    th:first-child, td:first-child {
        padding-left: 15px;
    }

    th:last-child, td:last-child {
        padding-right: 15px;
    }
}

@media (max-width: 480px) {
    .dashboard-container {
        padding: 10px;
    }

    .fixed-header-wrapper {
        margin: -10px -10px 0 -10px;
        padding: 10px 10px 10px 10px;
    }

    .header {
        padding: 12px 15px;
        border-radius: var(--radius-md);
    }

    .header-logo {
        width: 32px;
        height: 32px;
    }

    .header h2 {
        font-size: 16px;
    }

    .btn-back {
        padding: 8px 14px;
        font-size: 12px;
    }

    .btn-back i {
        display: none;
    }

    .booth-selector,
    .booth-info-box {
        padding: 15px;
        border-radius: var(--radius-md);
    }

    .booth-selector h3 {
        font-size: 16px;
    }

    #boothSelect {
        padding: 12px 16px;
        font-size: 13px;
    }

    .btn-load {
        padding: 12px 20px;
        font-size: 13px;
    }

    .booth-stats {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .stat-item {
        padding: 15px 10px;
    }

    .stat-item .value {
        font-size: 24px;
    }

    .stat-item h4 {
        font-size: 10px;
    }

    .table-container {
        border-radius: var(--radius-md);
    }

    table {
        font-size: 11px;
    }

    th, td {
        padding: 10px 8px;
    }

    .empty-state {
        border-radius: var(--radius-md);
        padding: 40px 15px;
    }

    .empty-state i {
        font-size: 48px;
    }

    .empty-state h4 {
        font-size: 18px;
    }
}

/* ================= SCROLL CUSTOMIZATION ================= */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-light);
}

::-webkit-scrollbar-thumb {
    background: var(--border-light);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}
</style>
</head>

<body>
<div class="dashboard-container">
    
    <!-- Fixed Header -->
    <div class="fixed-header-wrapper">
        <div class="header">
            <div class="header-left">
                <a href="/dashboard" class="btn-back">
                    <span>Back to Dashboard</span>
                </a>
            </div>
            <div class="header-title">
                <svg class="header-logo" viewBox="0 0 512 512">
                    <path d="M256 0c0 0-30 80-60 110-20 20-50 20-50 20s20 20 50 30c30 10 60-10 60-50 0 40 30 60 60 50 30-10 50-30 50-30s-30 0-50-20C286 80 256 0 256 0z"/>
                    <path d="M256 160c0 0-60 30-90 80-20 35-10 60-10 60s30-10 60-30c30-20 40-50 40-50s10 30 40 50c30 20 60 30 60 30s10-25-10-60c-30-50-90-80-90-80z"/>
                </svg>
                <div>
                    <h2>Booth-wise Voter Lists</h2>
                    <div class="header-subtitle">View and manage voters by booth</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="scrollable-content">
        
        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText"></span>
        </div>

        <!-- Booth Selector -->
        <div class="booth-selector">
            <h3><i class="fas fa-map-marker-alt"></i> Select Booth to View Voter List</h3>
            <div class="select-wrapper">
                <select id="boothSelect">
                    <option value="">-- Select a Booth --</option>
                </select>
                <button class="btn-load" onclick="loadBoothVoters()" id="loadBtn" disabled>
                    <i class="fas fa-search"></i> Load Voters
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading booth data...</p>
        </div>

        <!-- Booth Info Box -->
        <div class="booth-info-box" id="boothInfoBox">
            <div class="booth-info-header">
                <h3><i class="fas fa-clipboard-list"></i> <span id="selectedBoothName">Booth Name</span></h3>
                <button class="btn-download-pdf" onclick="downloadBoothPDF()">
                    <i class="fas fa-file-pdf"></i> Download PDF
                </button>
            </div>
            <div class="booth-stats">
                <div class="stat-item">
                    <h4>Total Voters</h4>
                    <div class="value" id="totalVoters">0</div>
                </div>
                <div class="stat-item visited">
                    <h4><i class="fas fa-check-circle"></i> Visited</h4>
                    <div class="value" id="visitedCount">0</div>
                </div>
                <div class="stat-item unvisited">
                    <h4><i class="fas fa-times-circle"></i> Not Visited</h4>
                    <div class="value" id="unvisitedCount">0</div>
                </div>
                <div class="stat-item percentage">
                    <h4><i class="fas fa-chart-pie"></i> Visit Rate</h4>
                    <div class="value" id="visitPercentage">0%</div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState">
            <i class="fas fa-inbox"></i>
            <h4>No Data Available</h4>
            <p>Please select a booth to view voter information</p>
        </div>

        <!-- Table -->
        <div class="table-container" id="tableContainer">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Sr No</th>
                            <th>Voter ID</th>
                            <th>Name (English)</th>
                            <th>Name (Marathi)</th>
                            <th>Relative Name</th>
                            <th>Status</th>
                            <th>Visited By</th>
                            <th>Visit Date</th>
                        </tr>
                    </thead>
                    <tbody id="votersTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const API = "";
    let selectedBooth = null;
    let currentBoothData = null;

    // Check authentication and admin status
    if (!localStorage.getItem("token")) {
        window.location.href = "/";
    }

    if (localStorage.getItem("isAdmin") !== "true") {
        alert("Access denied. This page is only for administrators.");
        window.location.href = "/dashboard";
    }

    // Load booths on page load
    loadBooths();

    function loadBooths() {
        fetch(API + "/admin/booths", {
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === "Success") {
                const select = document.getElementById("boothSelect");
                select.innerHTML = '<option value="">-- Select a Booth --</option>';
                
                data.data.forEach(booth => {
                    const option = document.createElement("option");
                    option.value = booth.Booths;
                    option.textContent = booth.Booths;
                    select.appendChild(option);
                });

                // Enable load button when booth is selected
                select.addEventListener('change', function() {
                    const loadBtn = document.getElementById("loadBtn");
                    loadBtn.disabled = !this.value;
                    selectedBooth = this.value;
                });
            } else {
                showError("Error loading booths: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error:", error);
            showError("Error loading booths. Please try again.");
        });
    }

    function loadBoothVoters() {
        if (!selectedBooth) {
            alert("Please select a booth first");
            return;
        }

        // Hide previous data
        document.getElementById("boothInfoBox").style.display = "none";
        document.getElementById("tableContainer").style.display = "none";
        document.getElementById("emptyState").style.display = "none";
        hideError();
        
        // Show loading
        showLoading(true);

        fetch(API + `/admin/booth-voters/${encodeURIComponent(selectedBooth)}`, {
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        })
        .then(res => res.json())
        .then(data => {
            showLoading(false);

            if (data.status === "Success") {
                currentBoothData = data.data;
                displayBoothData(data.data);
            } else {
                showError("Error loading booth data: " + data.message);
                document.getElementById("emptyState").style.display = "block";
            }
        })
        .catch(error => {
            console.error("Error:", error);
            showLoading(false);
            showError("Error loading booth data. Please try again.");
            document.getElementById("emptyState").style.display = "block";
        });
    }

    function displayBoothData(data) {
        const { booth_name, voters, stats } = data;

        // Update booth info
        document.getElementById("selectedBoothName").textContent = booth_name;
        document.getElementById("totalVoters").textContent = stats.total_voters;
        document.getElementById("visitedCount").textContent = stats.visited;
        document.getElementById("unvisitedCount").textContent = stats.unvisited;
        document.getElementById("visitPercentage").textContent = stats.visit_percentage + "%";
        document.getElementById("boothInfoBox").style.display = "block";

        // Populate table
        const tbody = document.getElementById("votersTable");
        tbody.innerHTML = "";

        if (voters.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8">
                        <div class="no-data">
                            <i class="fas fa-inbox"></i>
                            <h4>No Voters Found</h4>
                            <p>No voters found for this booth</p>
                        </div>
                    </td>
                </tr>
            `;
        } else {
            voters.forEach(voter => {
                const isVisited = !!voter.visited_by_name;
                
                const visitDate = voter.visited_at 
                    ? new Date(voter.visited_at).toLocaleDateString('en-GB', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric'
                    })
                    : '-';

                const row = document.createElement('tr');
                row.className = isVisited ? 'visited-row' : 'not-visited-row';
                
                row.innerHTML = `
                    <td>${voter.serial_no}</td>
                    <td><strong>${voter.voter_id}</strong></td>
                    <td>${voter.voter_name_en || '-'}</td>
                    <td>${voter.voter_name || voter.voter_name_en || '-'}</td>
                    <td>${voter.relative_name || '-'}</td>
                    <td>
                        <span class="status-badge ${isVisited ? 'visited' : 'not-visited'}">
                            <i class="fas fa-${isVisited ? 'check' : 'times'}"></i>
                            ${isVisited ? 'Visited' : 'Not Visited'}
                        </span>
                    </td>
                    <td>${voter.visited_by_name || '-'}</td>
                    <td>${visitDate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        document.getElementById("tableContainer").style.display = "block";
    }

    function downloadBoothPDF() {
        if (!selectedBooth) {
            alert("Please select a booth first");
            return;
        }

        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';

        fetch(API + `/admin/download-booth-pdf/${encodeURIComponent(selectedBooth)}`, {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token")
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to generate PDF");
            }
            return response.blob();
        })
        .then(blob => {
            // Create download link
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `booth_${selectedBooth.replace(/ /g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            document.body.appendChild(a);
            a.click();
            
            // Cleanup
            setTimeout(() => {
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }, 100);
            
            btn.disabled = false;
            btn.innerHTML = originalHTML;
        })
        .catch(error => {
            console.error("Error:", error);
            btn.disabled = false;
            btn.innerHTML = originalHTML;
            alert("Error downloading PDF. Please try again.");
        });
    }

    function showLoading(show) {
        document.getElementById("loading").style.display = show ? "block" : "none";
        document.getElementById("loadBtn").disabled = show || !selectedBooth;
    }

    function showError(message) {
        const errorDiv = document.getElementById("errorMessage");
        document.getElementById("errorText").textContent = message;
        errorDiv.style.display = "block";
    }

    function hideError() {
        document.getElementById("errorMessage").style.display = "none";
    }
</script>

</body>
</html>